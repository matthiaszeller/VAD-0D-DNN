model Ursino1998Model_VAD2 "HMIII VAD model"
  // EXTEND THE SUPERCLASS
  // CHOOSE THE HEART FAILURE LEVEL (MHF / SHF)
  extends HMIII.ModelParametersMHF;
  // IMPORT MATHCARD LIBRARY
  import Mathcard.Library.*;
  // ============================
  //
  // VAD DEVICE
  Mathcard.Library.Devices.VAD2 LVAD(RPM = Param_LVAD_RPM) annotation(
    Placement(visible = true, transformation(origin = {80.0, -20.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
  // LEFT ATRIUM
  Mathcard.Library.Heart.AutoregulatingChambers.Atrium LeftAtrium(C = Param_LeftAtrium_C, V0 = Param_LeftAtrium_V0, Vu0 = Param_LeftAtrium_Vu0) annotation(
    Placement(visible = true, transformation(origin = {30.0, 30.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
  // MITRALIC VALVE
  Mathcard.Library.Heart.Valves.Valve_AV MitralicValve(R = Param_MitralicValve_R) annotation(
    Placement(visible = true, transformation(origin = {30.0, 10.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
  // LEFT VENTRICLE
  Mathcard.Library.Heart.AutoregulatingChambers.Ventricle LeftVentricle(V0 = Param_LeftVentricle_V0, kR = Param_LeftVentricle_kR, Emax0 = Param_LeftVentricle_Emax0, EmaxRef0 = Param_LeftVentricle_EmaxRef0, AGain_Emax = Param_LeftVentricle_AGain_Emax, ADelay_Emax = Param_LeftVentricle_ADelay_Emax, ATau_Emax = Param_LeftVentricle_ATau_Emax, P0 = Param_LeftVentricle_P0, kE = Param_LeftVentricle_kE, TSys0 = Param_LeftVentricle_TSys0, kSys = Param_LeftVentricle_kSys, TRef0 = Param_LeftVentricle_TRef0, AGain_Ts = Param_LeftVentricle_AGain_Ts, ADelay_Ts = Param_LeftVentricle_ADelay_Ts, ATau_Ts = Param_LeftVentricle_ATau_Ts, AGain_Tv = Param_LeftVentricle_AGain_Tv, ADelay_Tv = Param_LeftVentricle_ADelay_Tv, ATau_Tv = Param_LeftVentricle_ATau_Tv) annotation(
    Placement(visible = true, transformation(origin = {30.0, -10.0}, extent = {{10.0, -10.0}, {-10.0, 10.0}}, rotation = 0)));
  // AORTIC VALVE
  Mathcard.Library.Heart.Valves.Valve_VC AorticValve(kR = Param_AorticValve_kR) annotation(
    Placement(visible = true, transformation(origin = {30.0, -30.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
  // SYSTEMIC ARTERIES
  Mathcard.Library.Vessels.I1O1.Linear.CRL_LP SystemicArteries(R = Param_SystemicArteries_R, I = Param_SystemicArteries_I, C = Param_SystemicArteries_C, V0 = Param_SystemicArteries_V0, Vu0 = Param_SystemicArteries_Vu0) annotation(
    Placement(visible = true, transformation(origin = {70.0, -80.0}, extent = {{10.0, -10.0}, {-10.0, 10.0}}, rotation = 0)));
  // SPLANCHNIC PERIPHERAL CIRCULATION
  Mathcard.Library.Vessels.I1O1.Autoregulating.CRL_LP_AR SplanchnicPeripheralCirculation(R0 = Param_SplanchnicPeripheralCirculation_R0, RRef0 = Param_SplanchnicPeripheralCirculation_RRef0, AGain = Param_SplanchnicPeripheralCirculation_AGain, ADelay = Param_SplanchnicPeripheralCirculation_ADelay, ATau = Param_SplanchnicPeripheralCirculation_ATau, I = Param_SplanchnicPeripheralCirculation_I, C = Param_SplanchnicPeripheralCirculation_C, V0 = Param_SplanchnicPeripheralCirculation_V0, Vu0 = Param_SplanchnicPeripheralCirculation_Vu0) annotation(
    Placement(visible = true, transformation(origin = {0.0, -90.0}, extent = {{10.0, -10.0}, {-10.0, 10.0}}, rotation = 0)));
  // EXTRASPLANCHNIC PERIPHERAL CIRCULATION
  Mathcard.Library.Vessels.I1O1.Autoregulating.CRL_LP_AR ExtraSplanchnicPeripheralCirculation(R0 = Param_ExtraSplanchnicPeripheralCirculation_R0, RRef0 = Param_ExtraSplanchnicPeripheralCirculation_RRef0, AGain = Param_ExtraSplanchnicPeripheralCirculation_AGain, ADelay = Param_ExtraSplanchnicPeripheralCirculation_ADelay, ATau = Param_ExtraSplanchnicPeripheralCirculation_ATau, I = Param_ExtraSplanchnicPeripheralCirculation_I, C = Param_ExtraSplanchnicPeripheralCirculation_C, V0 = Param_ExtraSplanchnicPeripheralCirculation_V0, Vu0 = Param_ExtraSplanchnicPeripheralCirculation_Vu0) annotation(
    Placement(visible = true, transformation(origin = {0.0, -70.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = -180)));
  // SPLANCHNIC VEINS
  Mathcard.Library.Vessels.I1O1.Autoregulating.CRL_LP_AVu SplanchnicVeins(R = Param_SplanchnicVeins_R, I = Param_SplanchnicVeins_I, C = Param_SplanchnicVeins_C, V0 = Param_SplanchnicVeins_V0, Vu0 = Param_SplanchnicVeins_Vu0, VuRef0 = Param_SplanchnicVeins_VuRef0, AGain = Param_SplanchnicVeins_AGain, ADelay = Param_SplanchnicVeins_ADelay, ATau = Param_SplanchnicVeins_ATau) annotation(
    Placement(visible = true, transformation(origin = {-70.0, -90.0}, extent = {{10.0, -10.0}, {-10.0, 10.0}}, rotation = 0)));
  // EXTRASPLANCHNIC VEINS
  Mathcard.Library.Vessels.I1O1.Autoregulating.CRL_LP_AVu ExtraSplanchnicVeins(R = Param_ExtraSplanchnicVeins_R, I = Param_ExtraSplanchnicVeins_I, C = Param_ExtraSplanchnicVeins_C, V0 = Param_ExtraSplanchnicVeins_V0, Vu0 = Param_ExtraSplanchnicVeins_Vu0, VuRef0 = Param_ExtraSplanchnicVeins_VuRef0, AGain = Param_ExtraSplanchnicVeins_AGain, ADelay = Param_ExtraSplanchnicVeins_ADelay, ATau = Param_ExtraSplanchnicVeins_ATau) annotation(
    Placement(visible = true, transformation(origin = {-70.0, -70.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = -180)));
  // RIGHT ATRIUM
  Mathcard.Library.Heart.AutoregulatingChambers.Atrium RightAtrium(C = Param_RightAtrium_C, V0 = Param_RightAtrium_V0, Vu0 = Param_RightAtrium_Vu0) annotation(
    Placement(visible = true, transformation(origin = {-30.0, 30.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
  // TRICUSPID VALVE
  Mathcard.Library.Heart.Valves.Valve_AV TricuspidValve(R = Param_TricuspidValve_R) annotation(
    Placement(visible = true, transformation(origin = {-30.0, 10.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
  // RIGHT VENTRICLE
  Mathcard.Library.Heart.AutoregulatingChambers.Ventricle RightVentricle(V0 = Param_RightVentricle_V0, kR = Param_RightVentricle_kR, Emax0 = Param_RightVentricle_Emax0, EmaxRef0 = Param_RightVentricle_EmaxRef0, AGain_Emax = Param_RightVentricle_AGain_Emax, ADelay_Emax = Param_RightVentricle_ADelay_Emax, ATau_Emax = Param_RightVentricle_ATau_Emax, P0 = Param_RightVentricle_P0, kE = Param_RightVentricle_kE, TSys0 = Param_RightVentricle_TSys0, kSys = Param_RightVentricle_kSys, TRef0 = Param_RightVentricle_TRef0, AGain_Ts = Param_RightVentricle_AGain_Ts, ADelay_Ts = Param_RightVentricle_ADelay_Ts, ATau_Ts = Param_RightVentricle_ATau_Ts, AGain_Tv = Param_RightVentricle_AGain_Tv, ADelay_Tv = Param_RightVentricle_ADelay_Tv, ATau_Tv = Param_RightVentricle_ATau_Tv) annotation(
    Placement(visible = true, transformation(origin = {-30.0, -10.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
  // PULMONARY VALVE
  Mathcard.Library.Heart.Valves.Valve_VC PulmonaryValve(kR = Param_PulmonaryValve_kR) annotation(
    Placement(visible = true, transformation(origin = {-30.0, -30.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
  // PULMONARY ARTERIES
  Mathcard.Library.Vessels.I1O1.Linear.CRL_LP PulmonaryArteries(R = Param_PulmonaryArteries_R, I = Param_PulmonaryArteries_I, C = Param_PulmonaryArteries_C, V0 = Param_PulmonaryArteries_V0, Vu0 = Param_PulmonaryArteries_Vu0) annotation(
    Placement(visible = true, transformation(origin = {-50.0, 80.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = -360)));
  // PULMONARY PERIPHERAL CIRCULATION
  Mathcard.Library.Vessels.I1O1.Linear.CRL_LP PulmonaryPeriphericalCirculation(R = Param_PulmonaryPeriphericalCirculation_R, I = Param_PulmonaryPeriphericalCirculation_I, C = Param_PulmonaryPeriphericalCirculation_C, V0 = Param_PulmonaryPeriphericalCirculation_V0, Vu0 = Param_PulmonaryPeriphericalCirculation_Vu0) annotation(
    Placement(visible = true, transformation(origin = {0.0, 80.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
  // PULMONARY VEINS
  Mathcard.Library.Vessels.I1O1.Linear.CRL_LP PulmonaryVeins(R = Param_PulmonaryVeins_R, I = Param_PulmonaryVeins_I, C = Param_PulmonaryVeins_C, V0 = Param_PulmonaryVeins_V0, Vu0 = Param_PulmonaryVeins_Vu0) annotation(
    Placement(visible = true, transformation(origin = {50.0, 80.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
  // AUTOREGULATION CENTER
  Mathcard.Library.AutoregulationCenters.Autoregulation_Center AutoregulationCenter(TauP = Param_AutoregulationCenter_TauP, TauZ = Param_AutoregulationCenter_TauZ, Pn = Param_AutoregulationCenter_Pn, ka = Param_AutoregulationCenter_ka, fmin = Param_AutoregulationCenter_fmin, fmax = Param_AutoregulationCenter_fmax, fesinf = Param_AutoregulationCenter_fesinf, fes0 = Param_AutoregulationCenter_fes0, fesmin = Param_AutoregulationCenter_fesmin, kes = Param_AutoregulationCenter_kes, fev0 = Param_AutoregulationCenter_fev0, fevinf = Param_AutoregulationCenter_fevinf, fcs0 = Param_AutoregulationCenter_fcs0, kev = Param_AutoregulationCenter_kev) annotation(
    Placement(visible = true, transformation(origin = {0.0, -30.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = -630)));
equation
  connect(LVAD.Inlet, MitralicValve.Outlet) annotation(
    Line(visible = true, points = {{80.0, -12.0}, {80.0, 2.0}, {30.0, 2.0}}, color = {255, 0, 0}, thickness = 2));
  connect(LVAD.Outlet, SystemicArteries.Inlet) annotation(
    Line(visible = true, points = {{80.0, -28.0}, {80.0, -50.0}, {90.0, -50.0}, {90.0, -80.0}, {78.0, -80.0}}, color = {255, 0, 0}, thickness = 2));
  connect(AutoregulationCenter.Active_fes, RightVentricle.Active_fes) annotation(
    Line(visible = true, points = {{-3.0, -22.0}, {-3.0, -13.0}, {-21.0, -13.0}}, color = {0, 128, 0}, thickness = 1));
  connect(AutoregulationCenter.Active_fes, SplanchnicPeripheralCirculation.Active_fes) annotation(
    Line(visible = true, origin = {-2.2398, -21.5986}, points = {{-0.76, -0.401}, {-0.76, 8.599}, {-11.994, 8.599}, {-11.994, -58.401}, {2.2398, -58.4014}, {2.24, -64.401}}, color = {0, 128, 0}, thickness = 1));
  connect(AutoregulationCenter.Active_fes, ExtraSplanchnicPeripheralCirculation.Active_fes) annotation(
    Line(visible = true, origin = {1.0, 0.0}, points = {{-4.0, -22.0}, {-4.0, -13.0}, {-16.0, -13.0}, {-16.0, -80.0}, {-1.0, -80.0}, {-1.0, -74.0}}, color = {0, 128, 0}, thickness = 1));
  connect(AutoregulationCenter.Active_fes, ExtraSplanchnicVeins.Active_fes) annotation(
    Line(visible = true, origin = {1.0, 0.0}, points = {{-4.0, -22.0}, {-4.0, -13.0}, {-16.0, -13.0}, {-16.0, -80.0}, {-71.0, -80.0}, {-71.0, -74.0}}, color = {0, 128, 0}, thickness = 1));
  connect(AutoregulationCenter.Active_fes, SplanchnicVeins.Active_fes) annotation(
    Line(visible = true, origin = {23.6786, 38.8776}, points = {{-26.679, -60.878}, {-26.679, -51.878}, {-38.679, -51.878}, {-38.679, -118.878}, {-93.679, -118.878}, {-93.679, -124.878}}, color = {0, 128, 0}, thickness = 1));
  connect(AutoregulationCenter.Active_fev, RightVentricle.Active_fev) annotation(
    Line(visible = true, points = {{3.0, -22.0}, {3.0, -7.0}, {-21.0, -7.0}}, color = {0, 255, 0}, thickness = 1));
  connect(AutoregulationCenter.Active_fev, LeftVentricle.Active_fev) annotation(
    Line(visible = true, points = {{3.0, -22.0}, {3.0, -7.0}, {21.0, -7.0}}, color = {0, 255, 0}, thickness = 1));
  connect(AutoregulationCenter.Active_fes, LeftVentricle.Active_fes) annotation(
    Line(visible = true, points = {{-3.0, -22.0}, {-3.0, -13.0}, {21.0, -13.0}}, color = {0, 128, 0}, thickness = 1));
  connect(AutoregulationCenter.PressureProbe, AorticValve.Outlet) annotation(
    Line(visible = true, points = {{0.0, -38.0}, {30.0, -38.0}}, color = {255, 0, 255}, thickness = 1));
  connect(ExtraSplanchnicVeins.Outlet, RightAtrium.Inlet) annotation(
    Line(visible = true, origin = {77.7551, 55.6165}, points = {{-155.755, -125.617}, {-167.755, -125.617}, {-167.755, -5.617}, {-107.755, -5.617}, {-107.755, -17.617}}, color = {0, 128, 255}, thickness = 2));
  connect(SplanchnicVeins.Outlet, RightAtrium.Inlet) annotation(
    Line(visible = true, origin = {-63.176, -2.1599}, points = {{-14.824, -87.84}, {-26.824, -87.84}, {-26.824, 52.16}, {33.176, 52.16}, {33.176, 40.16}}, color = {0, 128, 255}, thickness = 2));
  connect(ExtraSplanchnicPeripheralCirculation.Outlet, ExtraSplanchnicVeins.Inlet) annotation(
    Line(visible = true, origin = {-35.0, -70.0}, points = {{27.0, 0.0}, {-27.0, 0.0}}, color = {0, 128, 255}, thickness = 2));
  connect(SplanchnicPeripheralCirculation.Outlet, SplanchnicVeins.Inlet) annotation(
    Line(visible = true, origin = {-35.0, -90.0}, points = {{27.0, 0.0}, {-27.0, 0.0}}, color = {0, 128, 255}, thickness = 2));
  connect(SystemicArteries.Outlet, SplanchnicPeripheralCirculation.Inlet) annotation(
    Line(visible = true, points = {{62.0, -80.0}, {50.0, -80.0}, {50.0, -90.0}, {8.0, -90.0}}, color = {255, 0, 0}, thickness = 2));
  connect(SystemicArteries.Outlet, ExtraSplanchnicPeripheralCirculation.Inlet) annotation(
    Line(visible = true, origin = {50.0, -75.0}, points = {{12.0, -5.0}, {0.0, -5.0}, {0.0, 5.0}, {-42.0, 5.0}}, color = {255, 0, 0}, thickness = 2));
  connect(AorticValve.Outlet, SystemicArteries.Inlet) annotation(
    Line(visible = true, origin = {73.4354, -42.1173}, points = {{-43.435, 4.117}, {-43.435, -7.883}, {16.565, -7.883}, {16.565, -37.883}, {4.565, -37.883}}, color = {255, 0, 0}, thickness = 2));
  connect(PulmonaryVeins.Outlet, LeftAtrium.Inlet) annotation(
    Line(visible = true, points = {{58.0, 80.0}, {70.0, 80.0}, {70.0, 50.0}, {30.0, 50.0}, {30.0, 38.0}}, color = {255, 0, 0}, thickness = 2));
  connect(PulmonaryPeriphericalCirculation.Outlet, PulmonaryVeins.Inlet) annotation(
    Line(visible = true, origin = {25.0, 80.0}, points = {{-17.0, 0.0}, {17.0, 0.0}}, color = {255, 0, 0}, thickness = 2));
  connect(PulmonaryArteries.Outlet, PulmonaryPeriphericalCirculation.Inlet) annotation(
    Line(visible = true, origin = {-25.0, 80.0}, points = {{-17.0, 0.0}, {17.0, 0.0}}, color = {0, 128, 255}, thickness = 2));
  connect(PulmonaryValve.Outlet, PulmonaryArteries.Inlet) annotation(
    Line(visible = true, origin = {19.0, -76.0}, points = {{-49.0, 38.0}, {-49.0, 26.0}, {-89.0, 26.0}, {-89.0, 156.0}, {-77.0, 156.0}}, color = {0, 128, 255}, thickness = 2));
  connect(LeftVentricle.Outlet, AorticValve.Inlet) annotation(
    Line(visible = true, origin = {30.0, -20.6667}, points = {{0.0, 2.6667}, {0.0, -1.3333}, {0.0, -1.3333}}));
  connect(MitralicValve.Outlet, LeftVentricle.Inlet) annotation(
    Line(visible = true, origin = {30.0, -0.6667}, points = {{0.0, 2.6667}, {0.0, -1.3333}, {0.0, -1.3333}}));
  connect(LeftAtrium.Outlet, MitralicValve.Inlet) annotation(
    Line(visible = true, origin = {30.0, 19.3333}, points = {{0.0, 2.6667}, {0.0, -1.3333}, {0.0, -1.3333}}));
  connect(RightVentricle.Outlet, PulmonaryValve.Inlet) annotation(
    Line(visible = true, origin = {-30.0, -20.6667}, points = {{0.0, 2.6667}, {0.0, -1.3333}, {0.0, -1.3333}}));
  connect(TricuspidValve.Outlet, RightVentricle.Inlet) annotation(
    Line(visible = true, origin = {-30.0, -0.6667}, points = {{0.0, 2.6667}, {0.0, -1.3333}, {0.0, -1.3333}}));
  connect(RightAtrium.Outlet, TricuspidValve.Inlet) annotation(
    Line(visible = true, points = {{-30.0, 22.0}, {-30.0, 18.0}}));
  annotation(
    experiment(StopTime = 200),
    Diagram(coordinateSystem(extent = {{-100.0, -100.0}, {100.0, 100.0}}, preserveAspectRatio = true, initialScale = 0.1, grid = {10, 10})));
end Ursino1998Model_VAD2;
